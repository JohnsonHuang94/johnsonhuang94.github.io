<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mock.js | JohnsonHuang94 Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="">
    <meta name="description" content="丢掉幻想，准备斗争">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.328d93af.js" as="script"><link rel="preload" href="/assets/js/2.5061cb53.js" as="script"><link rel="preload" href="/assets/js/10.ad15b253.js" as="script"><link rel="prefetch" href="/assets/js/3.bb11695f.js"><link rel="prefetch" href="/assets/js/4.447ceac1.js"><link rel="prefetch" href="/assets/js/5.f86b2531.js"><link rel="prefetch" href="/assets/js/6.a2eaf443.js"><link rel="prefetch" href="/assets/js/7.4fc23ef0.js"><link rel="prefetch" href="/assets/js/8.eb1d19c8.js"><link rel="prefetch" href="/assets/js/9.0e39bd37.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.jpg" alt="JohnsonHuang94 Blog" class="logo"> <span class="site-name can-hide">JohnsonHuang94 Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/JohnsonHuang94/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/JohnsonHuang94/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/document/vue" class="sidebar-heading clickable router-link-active open"><span>Vue</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/vue/mock.html" aria-current="page" class="active sidebar-link">Mock.js</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mock-js"><a href="#mock-js" class="header-anchor">#</a> Mock.js</h1> <p>在日常开发中，前后端分离已是常态，前端攻城师独立于后台开发是非常有必要的，mock.js就是一款常用的拦截ajax请求，生成随机数据的工具，用于模拟接口返回数据。下面讲解如何在项目中使用它。</p> <p>首先我们来看一下目录结构（vue项目）<br> <img src="/images/vue/mock_mljg.png" alt="项目目录结构"></p> <p>安装mock</p> <div class="language- extra-class"><pre class="language-text"><code>npm install mockjs -D
</code></pre></div><p>在mock文件夹下面新建一个<code>index.js</code>和<code>user.js</code><br> <code>index.js</code>代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>import Mock from 'mockjs'
// 设置 300-600ms 的延时，模拟接口的延时
Mock.setup({
    timeout: '300-600'
});

let configArray = [];

// 使用webpack的require.context()遍历所有mock文件
// require.context( 文件夹目录， 是否遍历文件夹， 匹配文件后缀 )
const files = require.context('.', true, /\.js$/);
console.log('files', files)
files.keys().forEach((key) =&gt; {
  if (key === './index.js') return;
  configArray = configArray.concat(files(key).default);
});

// 注册所有的mock服务
configArray.forEach((item) =&gt; {
  // Object.entries() 返回可枚举属性的键值对数组
  // eg: let o = { a: 1, b: { c: 2 }}
  //      Object.entries(o)  =&gt;   [[a, 1], [b, {c:2}]]
  for (let [path, target] of Object.entries(item)) {
    let protocol = path.split('|');
    // 匹配接口
    console.log('mock_url', new RegExp('^' + protocol[1]))
    // 请求方式
    console.log('mock_type', protocol[0]) 
    // 返回相应的template或者 执行相应的function，并返回数据
    console.log('mock_temp_or_func', target)
    Mock.mock(new RegExp('^' + protocol[1]), protocol[0], target);
  }
});
</code></pre></div><p>其中Mock.mock是mock.js提供的接口，用法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>// rurl =&gt; 需要拦截的接口url，可选参数
// rtype =&gt; 请求方式（get、post、delete等等），可选参数
// template | function =&gt; 返回的模板 | 执行相应的函数，并且返回相应的模板

Mock.mock( rurl?, rtype?, template|function )
</code></pre></div><p><code>user.js</code>代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>/******************
 * 基础 - 用户信息 - mock
 *****************/
// 用户信息
let user = {
    &quot;code&quot;:0,
    &quot;msg&quot;:&quot;&quot;,
    &quot;data&quot;:{
        &quot;given_name&quot;:&quot;星星&quot;,
        &quot;first_name&quot;:&quot;周&quot;,
        &quot;phone&quot;:&quot;159****3622&quot;,
        &quot;email&quot;:&quot;***@163.com&quot;,
        &quot;qq&quot;:&quot;123456588&quot;,
        &quot;cover&quot;:&quot;http://cdn.your-domain-name.com/img/5f15901f5e3.png@!tiny&quot;,
        &quot;number&quot;:90649107,
        &quot;bind_wechat&quot;:0,
        &quot;full_name&quot;:&quot;周星星&quot;,
        &quot;province&quot;:&quot;香港&quot;,
        &quot;province_id&quot;:5687,
        &quot;city&quot;:&quot;中西区&quot;,
        &quot;city_id&quot;:5688,
        &quot;area&quot;:&quot;中西区&quot;,
        &quot;area_id&quot;:89299,
    }
}
export default {
    /**
     * 基础 - 登录
     * @param： {}    
     * @returns：Promise {&lt;pending&gt;}
     **/
    'post|/user/center': () =&gt; {
        return user
    }
}
</code></pre></div><p>这样我们就已经编写好mock文件了，接下来需要在main.js中引入mock文件</p> <div class="language- extra-class"><pre class="language-text"><code>// 开发模式下才引入mock
process.env.NODE_ENV === 'development' &amp;&amp; require('./mock') 
</code></pre></div><p>接下来，当我们在组件页面中请求了<code>/user/center</code>时，mock就会主动拦截请求，并返回我们定义好的template数据</p> <div class="language- extra-class"><pre class="language-text"><code>import axios from 'axios'

axios.post('/user/center').then( res =&gt; {
    console.log(res)
})
</code></pre></div><p>这里有一个细节需要注意，由于请求被mock拦截了，所以我们在NetWork里面是找不到这个请求的，可以通过在控制台将数据打印出来进行验证：<br> <img src="/images/vue/mock_network.jpg" alt="network查看请求"><br> <img src="/images/vue/mock_console.jpg" alt="控制台打印"></p> <p>##参考</p> <ul><li><a href="https://github.com/nuysoft/Mock/wiki/Getting-Started" target="_blank" rel="noopener noreferrer">Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/c5568910e946" target="_blank" rel="noopener noreferrer">简书文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.328d93af.js" defer></script><script src="/assets/js/2.5061cb53.js" defer></script><script src="/assets/js/10.ad15b253.js" defer></script>
  </body>
</html>
